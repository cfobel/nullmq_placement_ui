<html>
<head>
<title>NullMQ echo server example</title>
<link href="/dist/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="/dist/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript" src="http://jashkenas.github.com/coffee-script/extras/coffee-script.js"></script>
<script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
<script type="text/javascript" src="/dist/lib/stomp.js"></script>
<script type="text/javascript" src="/dist/nullmq.js"></script>
</head>
<body>
<div class="container">

<section id="echo_server_example">
  <div class="page-header">
    <h1>NullMQ echo server example</h1>
  </div>
  <div class="row">
    <p class="lead">Click the button below to load block positions from placement controller.</p>
    <fieldset>
        <button name="load_placement" id="id_load_placement">Load placement</button>
    </fieldset>
  </div>
</section>

<section id="placement">
  <div class="row">
    <div id="chart" class="span8 visible"></div>
    <div class="span4">
      <div class="row">
        <h3>Current block:</h3>
        <div id="placement_info_current" class="span4 visible" ></div>
      </div>
    </div>
    <div class="span4">
      <div class="row">
        <h3>Selected blocks:</h3>
        <div id="placement_info_selected" class="span4 visible" ></div>
      </div>
    </div>
    <div id="placement_info_template" class="invisible" >
    <!-- The contents of the tag are used as a template to format an info table
        for a block -->
        <table class="condensed-table table-bordered table-striped table-hover">
            <tbody>
            <tr><th>Coordinates</th><td class="block_coordinates">({{ x }}, {{ y }})</td></tr>
            <tr><th>Block id</th><td class="block_id">{{ block_id }}</td></tr>
            </tbody>
        </table>
    </div>
  </div>
</section>

<script type="text/coffeescript" src="/dist/grid.coffee"></script>
<script type="text/coffeescript" src="/dist/echo_controller.coffee"></script>
<script type="text/coffeescript">
    @context = new nullmq.Context('ws://maeby.fobel.net:9000')
    @placement_grid = new PlacementGrid("#chart", 600)

    class PlacementController extends EchoJsonController
        on_recv: (json_v) =>
            v = super json_v
            placement_grid.set_data(v.result)

    @echo_controller = new PlacementController(@context, 'tcp://localhost:9003')

    $("#id_load_placement").click(() =>
        echo_controller.do_request('{"command": "get_block_positions"}')
    )
</script>
</body>
</html>
